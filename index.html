<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Official website of Sharp Token (SHRP) - A decentralized and advanced token on Binance Smart Chain">
    <meta property="og:title" content="Sharp Token (SHRP)">
    <meta property="og:description" content="Official website of Sharp Token with staking, swapping and wallet integration">
    <title>Sharp Token (SHRP)</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.13.5/ethers.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@walletconnect/web3-provider@1.7.8/dist/umd/index.min.js"></script>
    <script src="https://unpkg.com/chart.js@3.7.1/dist/chart.min.js"></script>

    <style>
        /* Your existing CSS styles remain unchanged */
        /* ... */
    </style>
</head>
<body>
    <div class="container">
        <!-- Your existing HTML content remains unchanged -->
        <!-- ... -->
    </div>

    <!-- Transfer Modal -->
    <div id="transfer-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: center;">
        <div style="background: var(--card-bg); padding: 30px; border-radius: 10px; max-width: 500px; width: 90%;">
            <h2 style="margin-top: 0;">Transfer SHRP</h2>
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 5px;">Recipient Address</label>
                <input type="text" id="recipient-address" style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #444; background: #333; color: white;">
            </div>
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 5px;">Amount</label>
                <input type="number" id="transfer-amount" style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #444; background: #333; color: white;">
            </div>
            <div style="display: flex; justify-content: space-between;">
                <button onclick="hideModal('transfer-modal')" class="btn btn-outline">Cancel</button>
                <button onclick="transferTokens()" class="btn">Transfer</button>
            </div>
        </div>
    </div>

    <!-- Swap Modal -->
    <div id="swap-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: center;">
        <div style="background: var(--card-bg); padding: 30px; border-radius: 10px; max-width: 500px; width: 90%;">
            <h2 style="margin-top: 0;">Swap Tokens</h2>
            <!-- Swap form content here -->
            <div style="display: flex; justify-content: space-between;">
                <button onclick="hideModal('swap-modal')" class="btn btn-outline">Cancel</button>
                <button onclick="swapTokens()" class="btn">Swap</button>
            </div>
        </div>
    </div>

    <!-- Stake Modal -->
    <div id="stake-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: center;">
        <div style="background: var(--card-bg); padding: 30px; border-radius: 10px; max-width: 500px; width: 90%;">
            <h2 style="margin-top: 0;">Stake SHRP</h2>
            <!-- Stake form content here -->
            <div style="display: flex; justify-content: space-between;">
                <button onclick="hideModal('stake-modal')" class="btn btn-outline">Cancel</button>
                <button onclick="stakeTokens()" class="btn">Stake</button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let provider, signer, contract;
        const contractAddress = "0x697347f8d15bABaD054C84dAe3C8662addaf5c0b";
        const abi = [
            {
                "inputs": [{ "internalType": "address", "name": "account", "type": "address" }],
                "name": "balanceOf",
                "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    { "internalType": "address", "name": "recipient", "type": "address" },
                    { "internalType": "uint256", "name": "amount", "type": "uint256" }
                ],
                "name": "transfer",
                "outputs": [{ "internalType": "bool", "name": "", "type": "bool" }],
                "stateMutability": "nonpayable",
                "type": "function"
            }
        ];
        let priceChart;

        // Modal Functions (must be global)
        function showTransferModal() {
            if (!signer) {
                alert("Please connect your wallet first!");
                return;
            }
            document.getElementById("transfer-modal").style.display = "flex";
        }

        function showSwapModal() {
            if (!signer) {
                alert("Please connect your wallet first!");
                return;
            }
            document.getElementById("swap-modal").style.display = "flex";
        }

        function showStakeModal() {
            if (!signer) {
                alert("Please connect your wallet first!");
                return;
            }
            document.getElementById("stake-modal").style.display = "flex";
        }

        function hideModal(modalId) {
            document.getElementById(modalId).style.display = "none";
        }

        // Token Functions
        async function transferTokens() {
            const recipient = document.getElementById("recipient-address").value;
            const amount = document.getElementById("transfer-amount").value;
            
            if (!ethers.utils.isAddress(recipient)) {
                alert("Please enter a valid address!");
                return;
            }
            
            if (!amount || isNaN(amount) || Number(amount) <= 0) {
                alert("Please enter a valid amount!");
                return;
            }
            
            try {
                const tx = await contract.transfer(recipient, ethers.utils.parseEther(amount));
                hideModal('transfer-modal');
                alert("Transaction sent! Waiting for confirmation...");
                
                await tx.wait();
                alert("Transaction confirmed!");
                await updateWalletInfo();
            } catch (error) {
                console.error("Transfer error:", error);
                alert("Transfer failed! " + (error.message || ""));
            }
        }

        function swapTokens() {
            alert("Swap functionality will be implemented soon!");
            hideModal('swap-modal');
        }

        function stakeTokens() {
            alert("Staking functionality will be implemented soon!");
            hideModal('stake-modal');
        }

        // Wallet Connection Functions
        document.getElementById("connect-metamask").addEventListener("click", connectMetaMask);
        document.getElementById("connect-walletconnect").addEventListener("click", connectWalletConnect);

        async function connectMetaMask() {
            if (typeof window.ethereum !== "undefined") {
                try {
                    await window.ethereum.request({ method: "eth_requestAccounts" });
                    provider = new ethers.providers.Web3Provider(window.ethereum);
                    signer = provider.getSigner();
                    await setupContract();
                    
                    window.ethereum.on("accountsChanged", async (accounts) => {
                        if (accounts.length > 0) {
                            await updateWalletInfo();
                        } else {
                            document.getElementById("wallet-info").style.display = "none";
                        }
                    });
                    
                    window.ethereum.on("chainChanged", () => {
                        window.location.reload();
                    });
                } catch (error) {
                    console.error("Error connecting:", error);
                    alert("Connection failed!");
                }
            } else {
                alert("Please install MetaMask!");
            }
        }

        async function connectWalletConnect() {
            const walletConnectProvider = new WalletConnectProvider({
                rpc: {
                    56: "https://bsc-dataseed.binance.org/",
                    97: "https://data-seed-prebsc-1-s1.binance.org:8545/"
                },
                chainId: 56
            });
            
            try {
                await walletConnectProvider.enable();
                provider = new ethers.providers.Web3Provider(walletConnectProvider);
                signer = provider.getSigner();
                await setupContract();
                
                walletConnectProvider.on("disconnect", () => {
                    document.getElementById("wallet-info").style.display = "none";
                });
            } catch (error) {
                console.error("WalletConnect error:", error);
                alert("Connection failed!");
            }
        }

        // Helper Functions
        async function setupContract() {
            contract = new ethers.Contract(contractAddress, abi, signer);
            await updateWalletInfo();
            document.getElementById("wallet-info").style.display = "block";
            fetchTokenPrice();
            setupChart();
        }

        async function updateWalletInfo() {
            try {
                const address = await signer.getAddress();
                const balance = await contract.balanceOf(address);
                const bnbBalance = await provider.getBalance(address);
                
                document.getElementById("wallet-address").textContent = 
                    `${address.slice(0, 6)}...${address.slice(-4)}`;
                document.getElementById("token-balance").textContent = 
                    ethers.utils.formatEther(balance);
                document.getElementById("bnb-balance").textContent = 
                    ethers.utils.formatEther(bnbBalance).substring(0, 6);
            } catch (error) {
                console.error("Error updating wallet info:", error);
            }
        }

        async function addTokenToWallet() {
            try {
                const wasAdded = await window.ethereum.request({
                    method: "wallet_watchAsset",
                    params: {
                        type: "ERC20",
                        options: {
                            address: contractAddress,
                            symbol: "SHRP",
                            decimals: 18,
                            image: "https://yourwebsite.com/shrp-logo.png",
                        },
                    },
                });
                
                if (wasAdded) {
                    alert("SHRP token added to your wallet!");
                } else {
                    alert("Token addition was canceled.");
                }
            } catch (error) {
                console.error("Error adding token:", error);
                alert("Error adding token. Check console for details.");
            }
        }

        async function fetchTokenPrice() {
            try {
                // This would be replaced with actual API calls
                document.getElementById("token-price").textContent = "$0.00";
                document.getElementById("market-cap").textContent = "$0.00";
                document.getElementById("price-change").textContent = "0%";
            } catch (error) {
                console.error("Error fetching price:", error);
            }
        }

        function setupChart() {
            const ctx = document.getElementById('price-chart').getContext('2d');
            priceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'SHRP Price',
                        data: [0.0012, 0.0015, 0.0018, 0.0021, 0.0019, 0.0023],
                        borderColor: '#00d4ff',
                        backgroundColor: 'rgba(0, 212, 255, 0.1)',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#aaa'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#aaa'
                            }
                        }
                    }
                }
            });
        }

        // Initialize on load
        window.addEventListener('load', () => {
            // Any initialization code if needed
        });
    </script>
</body>
</html>
